{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 48, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Utsav%20Prajapati/Downloads/manhar-total-solution-website%20%282%29/manhar-total-solution-website/lib/db.ts"],"sourcesContent":["import { Pool } from 'pg'\n\nconsole.log('üì¶ Database: Initializing connection pool...')\n\nexport const pool = new Pool({\n  connectionString: process.env.DATABASE_URL,\n  ssl: false,\n  max: 20,\n  idleTimeoutMillis: 30000,\n  connectionTimeoutMillis: 5000,\n})\n\npool.on('connect', () => {\n  console.log('‚úÖ Database: New client connected to PostgreSQL')\n})\n\npool.on('error', (err) => {\n  console.error('‚ùå Database: Unexpected error on idle client', (err as Error).message)\n})\n\npool.on('remove', () => {\n  console.log('üîå Database: Client disconnected')\n})\n\nexport const query = async (text: string, params?: any[]) => {\n  console.log('üìù Database: Executing query:', text.substring(0, 50) + '...')\n  const start = Date.now()\n  try {\n    const res = await pool.query(text, params)\n    const duration = Date.now() - start\n    console.log(`‚úÖ Database: Query executed in ${duration}ms, returned ${res.rowCount} rows`)\n    return res\n  } catch (error) {\n    console.error('‚ùå Database: Query error:', (error as Error).message)\n    throw error\n  }\n}\n\nexport const getClient = async () => {\n  console.log('üîó Database: Getting client from pool...')\n  const client = await pool.connect()\n  return client\n}\n\nexport const testConnection = async () => {\n  try {\n    const result = await pool.query('SELECT NOW() as current_time, version() as pg_version')\n    console.log('‚úÖ Database: Connection successful!')\n    console.log('   Server Time:', result.rows[0].current_time)\n    console.log('   PostgreSQL Version:', result.rows[0].pg_version.substring(0, 30))\n    return { success: true, time: result.rows[0].current_time, version: result.rows[0].pg_version }\n  } catch (error: any) {\n    console.error('‚ùå Database: Connection failed!')\n    console.error('   Error:', error.message)\n    return { success: false, error: error.message }\n  }\n}\n\nexport default pool\n"],"names":[],"mappings":";;;;;;;;;;;;AAAA;;;;;;AAEA,QAAQ,GAAG,CAAC;AAEL,MAAM,OAAO,IAAI,+PAAI,CAAC;IAC3B,kBAAkB,QAAQ,GAAG,CAAC,YAAY;IAC1C,KAAK;IACL,KAAK;IACL,mBAAmB;IACnB,yBAAyB;AAC3B;AAEA,KAAK,EAAE,CAAC,WAAW;IACjB,QAAQ,GAAG,CAAC;AACd;AAEA,KAAK,EAAE,CAAC,SAAS,CAAC;IAChB,QAAQ,KAAK,CAAC,+CAA+C,AAAC,IAAc,OAAO;AACrF;AAEA,KAAK,EAAE,CAAC,UAAU;IAChB,QAAQ,GAAG,CAAC;AACd;AAEO,MAAM,QAAQ,OAAO,MAAc;IACxC,QAAQ,GAAG,CAAC,iCAAiC,KAAK,SAAS,CAAC,GAAG,MAAM;IACrE,MAAM,QAAQ,KAAK,GAAG;IACtB,IAAI;QACF,MAAM,MAAM,MAAM,KAAK,KAAK,CAAC,MAAM;QACnC,MAAM,WAAW,KAAK,GAAG,KAAK;QAC9B,QAAQ,GAAG,CAAC,CAAC,8BAA8B,EAAE,SAAS,aAAa,EAAE,IAAI,QAAQ,CAAC,KAAK,CAAC;QACxF,OAAO;IACT,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,4BAA4B,AAAC,MAAgB,OAAO;QAClE,MAAM;IACR;AACF;AAEO,MAAM,YAAY;IACvB,QAAQ,GAAG,CAAC;IACZ,MAAM,SAAS,MAAM,KAAK,OAAO;IACjC,OAAO;AACT;AAEO,MAAM,iBAAiB;IAC5B,IAAI;QACF,MAAM,SAAS,MAAM,KAAK,KAAK,CAAC;QAChC,QAAQ,GAAG,CAAC;QACZ,QAAQ,GAAG,CAAC,mBAAmB,OAAO,IAAI,CAAC,EAAE,CAAC,YAAY;QAC1D,QAAQ,GAAG,CAAC,0BAA0B,OAAO,IAAI,CAAC,EAAE,CAAC,UAAU,CAAC,SAAS,CAAC,GAAG;QAC7E,OAAO;YAAE,SAAS;YAAM,MAAM,OAAO,IAAI,CAAC,EAAE,CAAC,YAAY;YAAE,SAAS,OAAO,IAAI,CAAC,EAAE,CAAC,UAAU;QAAC;IAChG,EAAE,OAAO,OAAY;QACnB,QAAQ,KAAK,CAAC;QACd,QAAQ,KAAK,CAAC,aAAa,MAAM,OAAO;QACxC,OAAO;YAAE,SAAS;YAAO,OAAO,MAAM,OAAO;QAAC;IAChD;AACF;uCAEe"}},
    {"offset": {"line": 151, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Utsav%20Prajapati/Downloads/manhar-total-solution-website%20%282%29/manhar-total-solution-website/lib/auth.ts"],"sourcesContent":["import jwt from 'jsonwebtoken'\nimport bcrypt from 'bcryptjs'\n\nconst JWT_SECRET = process.env.JWT_SECRET || 'manhar-secret-key-change-in-production'\nconst JWT_EXPIRES_IN = '7d'\n\nexport interface UserPayload {\n  id: number\n  email: string\n  name: string\n  role: string\n}\n\nexport async function hashPassword(password: string): Promise<string> {\n  const salt = await bcrypt.genSalt(10)\n  return bcrypt.hash(password, salt)\n}\n\nexport async function comparePassword(password: string, hashedPassword: string): Promise<boolean> {\n  return bcrypt.compare(password, hashedPassword)\n}\n\nexport function generateToken(user: UserPayload): string {\n  return jwt.sign(user, JWT_SECRET, { expiresIn: JWT_EXPIRES_IN })\n}\n\nexport function verifyToken(token: string): UserPayload {\n  return jwt.verify(token, JWT_SECRET) as UserPayload\n}\n\nexport function generateRefreshToken(user: UserPayload): string {\n  return jwt.sign(user, JWT_SECRET + '-refresh', { expiresIn: '30d' })\n}\n"],"names":[],"mappings":";;;;;;;;;;;;AAAA;AACA;;;AAEA,MAAM,aAAa,QAAQ,GAAG,CAAC,UAAU,IAAI;AAC7C,MAAM,iBAAiB;AAShB,eAAe,aAAa,QAAgB;IACjD,MAAM,OAAO,MAAM,wPAAM,CAAC,OAAO,CAAC;IAClC,OAAO,wPAAM,CAAC,IAAI,CAAC,UAAU;AAC/B;AAEO,eAAe,gBAAgB,QAAgB,EAAE,cAAsB;IAC5E,OAAO,wPAAM,CAAC,OAAO,CAAC,UAAU;AAClC;AAEO,SAAS,cAAc,IAAiB;IAC7C,OAAO,4PAAG,CAAC,IAAI,CAAC,MAAM,YAAY;QAAE,WAAW;IAAe;AAChE;AAEO,SAAS,YAAY,KAAa;IACvC,OAAO,4PAAG,CAAC,MAAM,CAAC,OAAO;AAC3B;AAEO,SAAS,qBAAqB,IAAiB;IACpD,OAAO,4PAAG,CAAC,IAAI,CAAC,MAAM,aAAa,YAAY;QAAE,WAAW;IAAM;AACpE"}},
    {"offset": {"line": 207, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Utsav%20Prajapati/Downloads/manhar-total-solution-website%20%282%29/manhar-total-solution-website/app/api/gallery/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server'\nimport { query } from '@/lib/db'\nimport { verifyToken } from '@/lib/auth'\nimport { writeFile, mkdir } from 'fs/promises'\nimport { join } from 'path'\n\nexport async function GET() {\n  try {\n    const result = await query(\n      'SELECT gi.id, gi.image_url, gi.uploaded_at, u.name as uploaded_by_name FROM gallery_images gi LEFT JOIN users u ON gi.uploaded_by = u.id ORDER BY gi.uploaded_at DESC'\n    )\n    return NextResponse.json({ images: result.rows })\n  } catch (error) {\n    console.error('Gallery GET error:', error)\n    return NextResponse.json({ error: 'Failed to fetch images' }, { status: 500 })\n  }\n}\n\nexport async function POST(request: NextRequest) {\n  try {\n    const token = request.cookies.get('token')?.value\n    if (!token) {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 })\n    }\n\n    const user = verifyToken(token)\n    const formData = await request.formData()\n    const file = formData.get('image') as File\n\n    if (!file) {\n      return NextResponse.json({ error: 'No file uploaded' }, { status: 400 })\n    }\n\n    const allowedTypes = ['image/jpeg', 'image/png', 'image/webp']\n    if (!allowedTypes.includes(file.type)) {\n      return NextResponse.json({ error: 'Invalid file type. Only JPG, PNG and WebP are allowed' }, { status: 400 })\n    }\n\n    const maxSize = 5 * 1024 * 1024\n    if (file.size > maxSize) {\n      return NextResponse.json({ error: 'File too large. Maximum size is 5MB' }, { status: 400 })\n    }\n\n    const bytes = await file.arrayBuffer()\n    const buffer = Buffer.from(bytes)\n\n    const uploadDir = join(process.cwd(), 'public', 'uploads')\n    await mkdir(uploadDir, { recursive: true })\n\n    const ext = file.name.split('.').pop()\n    const filename = `${Date.now()}-${Math.random().toString(36).substring(7)}.${ext}`\n    const filepath = join(uploadDir, filename)\n\n    await writeFile(filepath, buffer)\n\n    const imageUrl = `/uploads/${filename}`\n    const result = await query(\n      'INSERT INTO gallery_images (image_url, uploaded_by) VALUES ($1, $2) RETURNING *',\n      [imageUrl, user.id]\n    )\n\n    return NextResponse.json({ \n      message: 'Image uploaded successfully', \n      image: result.rows[0] \n    }, { status: 201 })\n  } catch (error) {\n    console.error('Gallery POST error:', error)\n    return NextResponse.json({ error: 'Failed to upload image' }, { status: 500 })\n  }\n}\n"],"names":[],"mappings":";;;;;;AAAA;AACA;AACA;AACA;AACA;;;;;;;;;;AAEO,eAAe;IACpB,IAAI;QACF,MAAM,SAAS,MAAM,IAAA,8NAAK,EACxB;QAEF,OAAO,0PAAY,CAAC,IAAI,CAAC;YAAE,QAAQ,OAAO,IAAI;QAAC;IACjD,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,sBAAsB;QACpC,OAAO,0PAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAyB,GAAG;YAAE,QAAQ;QAAI;IAC9E;AACF;AAEO,eAAe,KAAK,OAAoB;IAC7C,IAAI;QACF,MAAM,QAAQ,QAAQ,OAAO,CAAC,GAAG,CAAC,UAAU;QAC5C,IAAI,CAAC,OAAO;YACV,OAAO,0PAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAe,GAAG;gBAAE,QAAQ;YAAI;QACpE;QAEA,MAAM,OAAO,IAAA,sOAAW,EAAC;QACzB,MAAM,WAAW,MAAM,QAAQ,QAAQ;QACvC,MAAM,OAAO,SAAS,GAAG,CAAC;QAE1B,IAAI,CAAC,MAAM;YACT,OAAO,0PAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAmB,GAAG;gBAAE,QAAQ;YAAI;QACxE;QAEA,MAAM,eAAe;YAAC;YAAc;YAAa;SAAa;QAC9D,IAAI,CAAC,aAAa,QAAQ,CAAC,KAAK,IAAI,GAAG;YACrC,OAAO,0PAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAwD,GAAG;gBAAE,QAAQ;YAAI;QAC7G;QAEA,MAAM,UAAU,IAAI,OAAO;QAC3B,IAAI,KAAK,IAAI,GAAG,SAAS;YACvB,OAAO,0PAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAsC,GAAG;gBAAE,QAAQ;YAAI;QAC3F;QAEA,MAAM,QAAQ,MAAM,KAAK,WAAW;QACpC,MAAM,SAAS,OAAO,IAAI,CAAC;QAE3B,MAAM,YAAY,IAAA,yGAAI,EAAC,QAAQ,GAAG,IAAI,UAAU;QAChD,MAAM,IAAA,8HAAK,EAAC,WAAW;YAAE,WAAW;QAAK;QAEzC,MAAM,MAAM,KAAK,IAAI,CAAC,KAAK,CAAC,KAAK,GAAG;QACpC,MAAM,WAAW,GAAG,KAAK,GAAG,GAAG,CAAC,EAAE,KAAK,MAAM,GAAG,QAAQ,CAAC,IAAI,SAAS,CAAC,GAAG,CAAC,EAAE,KAAK;QAClF,MAAM,WAAW,IAAA,yGAAI,EAAC,WAAW;QAEjC,MAAM,IAAA,kIAAS,EAAC,UAAU;QAE1B,MAAM,WAAW,CAAC,SAAS,EAAE,UAAU;QACvC,MAAM,SAAS,MAAM,IAAA,8NAAK,EACxB,mFACA;YAAC;YAAU,KAAK,EAAE;SAAC;QAGrB,OAAO,0PAAY,CAAC,IAAI,CAAC;YACvB,SAAS;YACT,OAAO,OAAO,IAAI,CAAC,EAAE;QACvB,GAAG;YAAE,QAAQ;QAAI;IACnB,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,uBAAuB;QACrC,OAAO,0PAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAyB,GAAG;YAAE,QAAQ;QAAI;IAC9E;AACF"}}]
}