{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 48, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Utsav%20Prajapati/Downloads/manhar-total-solution-website%20%282%29/manhar-total-solution-website/lib/db.ts"],"sourcesContent":["import { Pool } from 'pg'\n\nconsole.log('üì¶ Database: Initializing connection pool...')\n\nexport const pool = new Pool({\n  connectionString: process.env.DATABASE_URL,\n  ssl: false,\n  max: 20,\n  idleTimeoutMillis: 30000,\n  connectionTimeoutMillis: 5000,\n})\n\npool.on('connect', () => {\n  console.log('‚úÖ Database: New client connected to PostgreSQL')\n})\n\npool.on('error', (err) => {\n  console.error('‚ùå Database: Unexpected error on idle client', (err as Error).message)\n})\n\npool.on('remove', () => {\n  console.log('üîå Database: Client disconnected')\n})\n\nexport const query = async (text: string, params?: any[]) => {\n  console.log('üìù Database: Executing query:', text.substring(0, 50) + '...')\n  const start = Date.now()\n  try {\n    const res = await pool.query(text, params)\n    const duration = Date.now() - start\n    console.log(`‚úÖ Database: Query executed in ${duration}ms, returned ${res.rowCount} rows`)\n    return res\n  } catch (error) {\n    console.error('‚ùå Database: Query error:', (error as Error).message)\n    throw error\n  }\n}\n\nexport const getClient = async () => {\n  console.log('üîó Database: Getting client from pool...')\n  const client = await pool.connect()\n  return client\n}\n\nexport const testConnection = async () => {\n  try {\n    const result = await pool.query('SELECT NOW() as current_time, version() as pg_version')\n    console.log('‚úÖ Database: Connection successful!')\n    console.log('   Server Time:', result.rows[0].current_time)\n    console.log('   PostgreSQL Version:', result.rows[0].pg_version.substring(0, 30))\n    return { success: true, time: result.rows[0].current_time, version: result.rows[0].pg_version }\n  } catch (error: any) {\n    console.error('‚ùå Database: Connection failed!')\n    console.error('   Error:', error.message)\n    return { success: false, error: error.message }\n  }\n}\n\nexport default pool\n"],"names":[],"mappings":";;;;;;;;;;;;AAAA;;;;;;AAEA,QAAQ,GAAG,CAAC;AAEL,MAAM,OAAO,IAAI,+PAAI,CAAC;IAC3B,kBAAkB,QAAQ,GAAG,CAAC,YAAY;IAC1C,KAAK;IACL,KAAK;IACL,mBAAmB;IACnB,yBAAyB;AAC3B;AAEA,KAAK,EAAE,CAAC,WAAW;IACjB,QAAQ,GAAG,CAAC;AACd;AAEA,KAAK,EAAE,CAAC,SAAS,CAAC;IAChB,QAAQ,KAAK,CAAC,+CAA+C,AAAC,IAAc,OAAO;AACrF;AAEA,KAAK,EAAE,CAAC,UAAU;IAChB,QAAQ,GAAG,CAAC;AACd;AAEO,MAAM,QAAQ,OAAO,MAAc;IACxC,QAAQ,GAAG,CAAC,iCAAiC,KAAK,SAAS,CAAC,GAAG,MAAM;IACrE,MAAM,QAAQ,KAAK,GAAG;IACtB,IAAI;QACF,MAAM,MAAM,MAAM,KAAK,KAAK,CAAC,MAAM;QACnC,MAAM,WAAW,KAAK,GAAG,KAAK;QAC9B,QAAQ,GAAG,CAAC,CAAC,8BAA8B,EAAE,SAAS,aAAa,EAAE,IAAI,QAAQ,CAAC,KAAK,CAAC;QACxF,OAAO;IACT,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,4BAA4B,AAAC,MAAgB,OAAO;QAClE,MAAM;IACR;AACF;AAEO,MAAM,YAAY;IACvB,QAAQ,GAAG,CAAC;IACZ,MAAM,SAAS,MAAM,KAAK,OAAO;IACjC,OAAO;AACT;AAEO,MAAM,iBAAiB;IAC5B,IAAI;QACF,MAAM,SAAS,MAAM,KAAK,KAAK,CAAC;QAChC,QAAQ,GAAG,CAAC;QACZ,QAAQ,GAAG,CAAC,mBAAmB,OAAO,IAAI,CAAC,EAAE,CAAC,YAAY;QAC1D,QAAQ,GAAG,CAAC,0BAA0B,OAAO,IAAI,CAAC,EAAE,CAAC,UAAU,CAAC,SAAS,CAAC,GAAG;QAC7E,OAAO;YAAE,SAAS;YAAM,MAAM,OAAO,IAAI,CAAC,EAAE,CAAC,YAAY;YAAE,SAAS,OAAO,IAAI,CAAC,EAAE,CAAC,UAAU;QAAC;IAChG,EAAE,OAAO,OAAY;QACnB,QAAQ,KAAK,CAAC;QACd,QAAQ,KAAK,CAAC,aAAa,MAAM,OAAO;QACxC,OAAO;YAAE,SAAS;YAAO,OAAO,MAAM,OAAO;QAAC;IAChD;AACF;uCAEe"}},
    {"offset": {"line": 151, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Utsav%20Prajapati/Downloads/manhar-total-solution-website%20%282%29/manhar-total-solution-website/lib/auth.ts"],"sourcesContent":["import jwt from 'jsonwebtoken'\nimport bcrypt from 'bcryptjs'\n\nconst JWT_SECRET = process.env.JWT_SECRET || 'manhar-secret-key-change-in-production'\nconst JWT_EXPIRES_IN = '7d'\n\nexport interface UserPayload {\n  id: number\n  email: string\n  name: string\n  role: string\n}\n\nexport async function hashPassword(password: string): Promise<string> {\n  const salt = await bcrypt.genSalt(10)\n  return bcrypt.hash(password, salt)\n}\n\nexport async function comparePassword(password: string, hashedPassword: string): Promise<boolean> {\n  return bcrypt.compare(password, hashedPassword)\n}\n\nexport function generateToken(user: UserPayload): string {\n  return jwt.sign(user, JWT_SECRET, { expiresIn: JWT_EXPIRES_IN })\n}\n\nexport function verifyToken(token: string): UserPayload {\n  return jwt.verify(token, JWT_SECRET) as UserPayload\n}\n\nexport function generateRefreshToken(user: UserPayload): string {\n  return jwt.sign(user, JWT_SECRET + '-refresh', { expiresIn: '30d' })\n}\n"],"names":[],"mappings":";;;;;;;;;;;;AAAA;AACA;;;AAEA,MAAM,aAAa,QAAQ,GAAG,CAAC,UAAU,IAAI;AAC7C,MAAM,iBAAiB;AAShB,eAAe,aAAa,QAAgB;IACjD,MAAM,OAAO,MAAM,wPAAM,CAAC,OAAO,CAAC;IAClC,OAAO,wPAAM,CAAC,IAAI,CAAC,UAAU;AAC/B;AAEO,eAAe,gBAAgB,QAAgB,EAAE,cAAsB;IAC5E,OAAO,wPAAM,CAAC,OAAO,CAAC,UAAU;AAClC;AAEO,SAAS,cAAc,IAAiB;IAC7C,OAAO,4PAAG,CAAC,IAAI,CAAC,MAAM,YAAY;QAAE,WAAW;IAAe;AAChE;AAEO,SAAS,YAAY,KAAa;IACvC,OAAO,4PAAG,CAAC,MAAM,CAAC,OAAO;AAC3B;AAEO,SAAS,qBAAqB,IAAiB;IACpD,OAAO,4PAAG,CAAC,IAAI,CAAC,MAAM,aAAa,YAAY;QAAE,WAAW;IAAM;AACpE"}},
    {"offset": {"line": 195, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Utsav%20Prajapati/Downloads/manhar-total-solution-website%20%282%29/manhar-total-solution-website/app/api/auth/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server'\nimport { query } from '@/lib/db'\nimport { hashPassword, comparePassword, generateToken, verifyToken, UserPayload } from '@/lib/auth'\n\nexport async function POST(request: NextRequest) {\n  try {\n    const body = await request.json()\n    const { action, name, email, password } = body\n\n    if (action === 'register') {\n      if (!name || !email || !password) {\n        return NextResponse.json(\n          { error: 'Name, email and password are required' },\n          { status: 400 }\n        )\n      }\n\n      const existingUser = await query('SELECT id FROM users WHERE email = $1', [email])\n      if (existingUser.rows.length > 0) {\n        return NextResponse.json(\n          { error: 'Email already registered' },\n          { status: 400 }\n        )\n      }\n\n      const hashedPassword = await hashPassword(password)\n      const result = await query(\n        'INSERT INTO users (name, email, password) VALUES ($1, $2, $3) RETURNING id, name, email, role',\n        [name, email, hashedPassword]\n      )\n\n      const user = result.rows[0]\n      const token = generateToken({ id: user.id, email: user.email, name: user.name, role: user.role })\n\n      const response = NextResponse.json(\n        { message: 'User registered successfully', user: { id: user.id, name: user.name, email: user.email, role: user.role } },\n        { status: 201 }\n      )\n\n      response.cookies.set('token', token, {\n        httpOnly: true,\n        secure: process.env.NODE_ENV === 'production',\n        sameSite: 'lax',\n        maxAge: 60 * 60 * 24 * 7,\n        path: '/',\n      })\n\n      return response\n    }\n\n    if (action === 'login') {\n      if (!email || !password) {\n        return NextResponse.json(\n          { error: 'Email and password are required' },\n          { status: 400 }\n        )\n      }\n\n      const result = await query('SELECT * FROM users WHERE email = $1', [email])\n      if (result.rows.length === 0) {\n        return NextResponse.json(\n          { error: 'Invalid credentials' },\n          { status: 401 }\n        )\n      }\n\n      const user = result.rows[0]\n      const isValid = await comparePassword(password, user.password)\n      if (!isValid) {\n        return NextResponse.json(\n          { error: 'Invalid credentials' },\n          { status: 401 }\n        )\n      }\n\n      const token = generateToken({ id: user.id, email: user.email, name: user.name, role: user.role })\n\n      const response = NextResponse.json(\n        { message: 'Login successful', user: { id: user.id, name: user.name, email: user.email, role: user.role } }\n      )\n\n      response.cookies.set('token', token, {\n        httpOnly: true,\n        secure: process.env.NODE_ENV === 'production',\n        sameSite: 'lax',\n        maxAge: 60 * 60 * 24 * 7,\n        path: '/',\n      })\n\n      return response\n    }\n\n    return NextResponse.json({ error: 'Invalid action' }, { status: 400 })\n  } catch (error) {\n    console.error('Auth error:', error)\n    return NextResponse.json({ error: 'Internal server error' }, { status: 500 })\n  }\n}\n\nexport async function GET(request: NextRequest) {\n  try {\n    const token = request.cookies.get('token')?.value\n    if (!token) {\n      return NextResponse.json({ user: null }, { status: 200 })\n    }\n\n    const user = verifyToken(token) as UserPayload\n    return NextResponse.json({ user })\n  } catch {\n    return NextResponse.json({ user: null }, { status: 200 })\n  }\n}\n"],"names":[],"mappings":"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"}}]
}